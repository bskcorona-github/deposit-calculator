/**
 * 国交省ガイドライン参照機能
 * AI検証時に公式ガイドラインを優先的に参照
 */

/**
 * 国交省ガイドラインの重要な原則
 * 出典: 「原状回復をめぐるトラブルとガイドライン」（再改訂版）
 * https://www.mlit.go.jp/jutakukentiku/house/jutakukentiku_house_tk3_000024.html
 */
export const GUIDELINE_CORE_PRINCIPLES = `
【原状回復の基本原則】（国土交通省「原状回復をめぐるトラブルとガイドライン」より）

■ 原状回復の定義
賃借人の居住、使用により発生した建物価値の減少のうち、賃借人の故意・過失、善管注意義務違反、
その他通常の使用を超えるような使用による損耗・毀損を復旧すること。

【重要原則】
1. 通常の使用による損耗・経年劣化は「貸主負担」
2. 故意・過失・善管注意義務違反による損傷は「借主負担」
3. 借主負担の場合でも、経年劣化を考慮して減価償却を適用
4. 耐用年数を経過したものは残存価値（1円）のみ借主負担

■ 特約の有効要件（Q3より）
特約が有効となるには、以下の要件を満たす必要があります：
1. 特約の必要性があり、かつ、暴利的でないこと
2. 賃借人が特約により負担すべき範囲が明確であること
3. 賃借人が特約の内容を理解し、合意していること

■ クリーニング特約について（Q16より）
クリーニング特約の有効性は以下の点から判断されます：
1. 賃借人が負担すべき内容・範囲が示されているか
2. 通常損耗分についても負担させる趣旨及び具体的範囲が明記または口頭説明されているか
3. 費用として妥当か

【判例】
✓ 有効と判断：「契約終了時に専門業者による清掃を実施し、その費用とし2万5000円を負担する」
  理由：金額が月額賃料の半額以下で相応、内容が明確（東京地裁 平成21年9月18日）
  
✗ 無効と判断：「ルームクリーニングに要する費用は賃借人が負担する」（金額不明）
  理由：通常損耗まで負担させる特約とは言えない（東京地裁 平成21年1月16日）

■ 部分的な損傷の負担範囲（Q7より）
不注意でクロスの一部にキズをつけた場合：
- 原則：損傷部分のみ負担（㎡単位または枚単位）
- 部屋全体のクロス張替費用を負担する必要はない
- ただし、一部の色・模様が合わない場合は、一定の範囲（面単位）での張替えが認められる場合あり

■ 敷金返還と原状回復費用の明細（Q17より）
- 賃貸人は、敷金から差し引く原状回復費用について説明義務がある
- 賃借人は賃貸人に対して、明細を請求して説明を求めることができる
- 具体的根拠を明らかにする必要がある

■ 襖・障子・畳表の張替え（Q8より）
契約書に特に約定されていない場合：
- 通常の使用による損耗・汚損は貸主負担
- 賃借人の故意・過失による損傷は借主負担
- 日焦けによる変色や自然損耗は貸主負担

■ 契約時の立会いの重要性（Q1より）
- 入居時と退去時に賃貸人・賃借人双方が立ち会い
- チェックリストを作成
- 写真を撮影
- これにより、損耗・損傷の発生時期をめぐるトラブルが防げる

■ サインしてしまった場合（Q14より）
退去時の立会いでサインをした後でも：
- ガイドラインに照らして不当な請求であれば、負担を拒否できる可能性がある
- 故意・過失でない部分については費用負担の必要がない
- ただし、個別の事情により判断が異なる場合があるため、専門家への相談を推奨
`;

/**
 * 費用項目別のガイドライン
 */
export const GUIDELINE_BY_CATEGORY = {
  cleaning: `
【クリーニング費用】
■ 原則：貸主負担
- 通常の清掃は貸主が次の入居者を確保するために行うもの
- ハウスクリーニング代は貸主負担が原則

■ 借主負担となる場合
- 特約が有効な場合（内容・範囲が明確で、金額が妥当）
- 通常の清掃を超える特別な清掃が必要な場合

■ 特約の有効例
- 「専門業者による清掃費用として〇〇円（上限）を負担」
- 金額が月額賃料の半額以下で、相応な範囲
`,
  
  wallpaper: `
【壁紙（クロス）】
■ 耐用年数：6年（減価償却の対象）
■ 残存価値：1円（6年経過後）

■ 貸主負担
- 日焦けによる変色、自然損耗
- 通常の使用による軽微な損傷
- テレビ、冷蔵庫等の後部壁面の黒ずみ（電気ヤケ）
- ポスター、カレンダー等の掲示跡（通常の範囲）

■ 借主負担
- 喫煙によるヤニ汚れ、臭い（善管注意義務違反）
- ペットによる引っかき傷、臭い
- 落書き、故意によるキズ
- 釘穴、ネジ穴（下地ボードの張替えが必要な程度）

■ 張替え範囲
- 原則：損傷部分のみ（㎡単位）
- 一部の色・模様が合わない場合：面単位（一面）での張替え
- 部屋全体の張替えは原則として認められない
`,

  flooring: `
【床（フローリング、クッションフロア、畳）】
■ 耐用年数：6年（減価償却の対象）
■ 残存価値：1円（6年経過後）

■ 貸主負担
- 家具の設置跡（通常の使用範囲）
- 日焦けによる変色
- 畳の変色、フローリングの色落ち（経年劣化）

■ 借主負担
- 引っ越し作業等で生じた引きずり傷
- 飲み物等をこぼしたことによるシミ、カビ
- 冷蔵庫下のサビ跡
- タバコの焦げ跡
- ペットによる引っかき傷、臭い

■ 張替え範囲
- 原則：損傷部分のみ
- 色・模様が合わない場合：居室単位での張替え
`,

  equipment: `
【設備（エアコン、給湯器、照明等）】
■ 耐用年数：各設備により異なる
- エアコン：6年
- 給湯器：10年
- インターホン、火災報知器：8年

■ 貸主負担
- 経年劣化による故障
- 通常の使用による損耗
- 寿命による不具合

■ 借主負担
- 手入れ不足による故障（エアコンのフィルター清掃怠慢等）
- 故意・過失による破損
- 取扱説明書に反する使用による故障
`,

  key: `
【鍵交換費用】
■ 原則：貸主負担
- 防犯上の理由による鍵交換は貸主の責任

■ 借主負担となる場合
- 特約が有効な場合（内容・範囲が明確で、金額が妥当）
- 鍵を紛失した場合

■ 特約の有効例
- 「防犯上の鍵交換費用として〇〇円（上限）を負担」
- 金額が相場の範囲内（1～2万円程度）
`,
};

/**
 * 公式Q&Aへの参照リンク
 */
export const OFFICIAL_QA_URL = 'https://www.mlit.go.jp/jutakukentiku/house/jutakukentiku_house_tk3_000024.html';

/**
 * 費用項目のカテゴリを判定
 */
export function categorizeItem(description: string, category: string): keyof typeof GUIDELINE_BY_CATEGORY | null {
  const text = `${category} ${description}`.toLowerCase();
  
  if (text.includes('クリーニング') || text.includes('清掃')) {
    return 'cleaning';
  }
  if (text.includes('クロス') || text.includes('壁紙') || text.includes('壁')) {
    return 'wallpaper';
  }
  if (text.includes('フローリング') || text.includes('床') || text.includes('畳') || text.includes('cf')) {
    return 'flooring';
  }
  if (text.includes('エアコン') || text.includes('給湯') || text.includes('設備') || text.includes('照明')) {
    return 'equipment';
  }
  if (text.includes('鍵') || text.includes('シリンダー')) {
    return 'key';
  }
  
  return null;
}

/**
 * 項目に関連するガイドラインを取得
 */
export function getRelevantGuideline(description: string, category: string): string {
  const itemCategory = categorizeItem(description, category);
  
  let relevantGuideline = GUIDELINE_CORE_PRINCIPLES;
  
  if (itemCategory && GUIDELINE_BY_CATEGORY[itemCategory]) {
    relevantGuideline += '\n\n' + GUIDELINE_BY_CATEGORY[itemCategory];
  }
  
  return relevantGuideline;
}

/**
 * AI検証用の完全なガイドライン参照テキストを生成
 */
export function buildGuidelineReference(): string {
  return `
${GUIDELINE_CORE_PRINCIPLES}

【費用項目別の詳細ガイドライン】

${GUIDELINE_BY_CATEGORY.cleaning}

${GUIDELINE_BY_CATEGORY.wallpaper}

${GUIDELINE_BY_CATEGORY.flooring}

${GUIDELINE_BY_CATEGORY.equipment}

${GUIDELINE_BY_CATEGORY.key}

【参考資料】
- 国土交通省「原状回復をめぐるトラブルとガイドライン」（再改訂版）
- 公式Q&A: ${OFFICIAL_QA_URL}

上記ガイドラインを最優先で参照し、判定の根拠としてください。
`;
}
